import { writeFileSync, existsSync } from 'node:fs'
import { join } from 'node:path'

const features = [
  {
    name: 'AchievementHotfixStream',
    flag: 'achievementHotfixStream',
    title: 'ðŸ”§ Hotfix Stream',
    subtitle: 'Track emergency hotfix deployments with versioning',
    accent: 'orange',
    buttonClass: 'bg-orange-600 hover:bg-orange-700',
    buttonLabel: 'Record Hotfix',
    successMessage: 'âœ… Hotfix recorded onchain',
    logLabel: 'Hotfix Stream',
    functionName: 'createPost',
    fields: [
      { key: 'hotfixVersion', label: 'Hotfix Version', placeholder: 'v1.2.3-hotfix' },
      { key: 'issueDescription', label: 'Issue Description', placeholder: 'Describe the critical issue', multiline: true },
      { key: 'deploymentHash', label: 'Deployment Hash (Optional)', placeholder: '0x...', required: false },
    ],
  },
  {
    name: 'AchievementSafelistRegistry',
    flag: 'achievementSafelistRegistry',
    title: 'âœ… Safelist Registry',
    subtitle: 'Maintain onchain safelist entries for addresses, contracts, or domains',
    accent: 'green',
    buttonClass: 'bg-green-600 hover:bg-green-700',
    buttonLabel: 'Add to Safelist',
    successMessage: 'âœ… Safelist entry recorded onchain',
    logLabel: 'Safelist Registry',
    functionName: 'createPost',
    fields: [
      { key: 'safelistType', label: 'Safelist Type', placeholder: 'address / contract / domain' },
      { key: 'entryValue', label: 'Entry Value', placeholder: '0x... or example.com' },
      { key: 'reason', label: 'Reason (Optional)', placeholder: 'Why this entry is safelisted', required: false },
    ],
  },
  {
    name: 'AchievementStressTest',
    flag: 'achievementStressTest',
    title: 'ðŸ’¥ Stress Test Evidence',
    subtitle: 'Capture deterministic load-test scenarios and metrics',
    accent: 'purple',
    buttonClass: 'bg-purple-600 hover:bg-purple-700',
    buttonLabel: 'Record Stress Test',
    successMessage: 'âœ… Stress test recorded onchain',
    logLabel: 'Stress Test Evidence',
    functionName: 'createPost',
    fields: [
      { key: 'testScope', label: 'Test Scope', placeholder: 'Base RPC throughput, etc.' },
      { key: 'peakMetrics', label: 'Peak Metrics', placeholder: '10k tx/min, 250ms p99', multiline: true },
      { key: 'mitigationNotes', label: 'Mitigation Notes (Optional)', placeholder: 'Follow-up actions', required: false, multiline: true },
    ],
  },
  {
    name: 'AchievementAdaptiveEscrowTrees',
    flag: 'achievementAdaptiveEscrowTrees',
    title: 'ðŸŒ² Adaptive Escrow Trees',
    subtitle: 'Balance milestone escrows with programmable Merkle trees',
    accent: 'green',
    buttonClass: 'bg-emerald-600 hover:bg-emerald-700',
    buttonLabel: 'Publish Escrow Topology',
    successMessage: 'âœ… Escrow topology recorded onchain',
    logLabel: 'Adaptive Escrow Tree',
    functionName: 'createPost',
    fields: [
      { key: 'milestoneLineage', label: 'Milestone Lineage', placeholder: 'milestone-2025-q1-root' },
      { key: 'splitStrategy', label: 'Split Strategy', placeholder: '40/40/20 adaptive release' },
      { key: 'merkleRootCid', label: 'Merkle Root CID (Optional)', placeholder: 'bafy...', required: false },
    ],
  },
  {
    name: 'AchievementAttestationRelayMesh',
    flag: 'achievementAttestationRelayMesh',
    title: 'ðŸ•¸ï¸ Attestation Relay Mesh',
    subtitle: 'Relay third-party attestations with proof chains',
    accent: 'purple',
    buttonClass: 'bg-purple-600 hover:bg-purple-700',
    buttonLabel: 'Relay Attestation',
    successMessage: 'âœ… Attestation relayed into BuilderProof',
    logLabel: 'Attestation Relay Entry',
    functionName: 'createPost',
    fields: [
      { key: 'attestorAddress', label: 'Attestor Address', placeholder: '0xabc...def' },
      { key: 'attestationHash', label: 'Attestation Hash', placeholder: 'ipfs://... or 0xhash' },
      { key: 'relayNotes', label: 'Relay Notes (Optional)', placeholder: 'Context, witnesses, or review tags', multiline: true, required: false },
    ],
  },
  {
    name: 'AchievementSovereignWorkspaceClones',
    flag: 'achievementSovereignWorkspaceClones',
    title: 'ðŸ›°ï¸ Sovereign Workspace Clones',
    subtitle: 'Track isolated workspace clones and sync windows',
    accent: 'blue',
    buttonClass: 'bg-blue-600 hover:bg-blue-700',
    buttonLabel: 'Register Workspace Clone',
    successMessage: 'âœ… Workspace clone registered',
    logLabel: 'Workspace Clone Snapshot',
    functionName: 'createPost',
    fields: [
      { key: 'workspaceLabel', label: 'Workspace Label', placeholder: 'security-research-lab' },
      { key: 'syncFrequency', label: 'Sync Frequency', placeholder: 'Every 6 hours' },
      { key: 'stateDiffHash', label: 'State Diff Hash', placeholder: '0xstate...' },
    ],
  },
  {
    name: 'AchievementMultiTenantKpiMap',
    flag: 'achievementMultiTenantKpiMap',
    title: 'ðŸ§­ Multi-Tenant KPI Map',
    subtitle: 'Layer builder, squad, and program KPIs into one lattice',
    accent: 'orange',
    buttonClass: 'bg-orange-600 hover:bg-orange-700',
    buttonLabel: 'Log KPI Layer',
    successMessage: 'âœ… KPI layer anchored onchain',
    logLabel: 'Multi-Tenant KPI Layer',
    functionName: 'createPost',
    fields: [
      { key: 'programName', label: 'Program / Squad', placeholder: 'Base Fellowship' },
      { key: 'kpiLayer', label: 'KPI Layer', placeholder: 'Squad, Program, Org' },
      { key: 'metricObservation', label: 'Metric Observation', placeholder: 'Activation rate 67% w/ +5% WoW', multiline: true },
    ],
  },
  {
    name: 'AchievementParameterGuardrails',
    flag: 'achievementParameterGuardrails',
    title: 'ðŸš§ Parameter Guardrails',
    subtitle: 'Enforce reviewer-defined parameter envelopes',
    accent: 'purple',
    buttonClass: 'bg-purple-600 hover:bg-purple-700',
    buttonLabel: 'Set Guardrails',
    successMessage: 'âœ… Guardrails saved for this achievement',
    logLabel: 'Parameter Guardrails',
    functionName: 'addComment',
    fields: [
      { key: 'parameterName', label: 'Parameter Name', placeholder: 'maxBatchMint' },
      { key: 'minValue', label: 'Minimum Value', placeholder: '1' },
      { key: 'maxValue', label: 'Maximum Value', placeholder: '25' },
      { key: 'violationAction', label: 'Violation Action', placeholder: 'Pause + notify guardians', multiline: true },
    ],
  },
  {
    name: 'AchievementEvidenceDiffVisualizer',
    flag: 'achievementEvidenceDiffVisualizer',
    title: 'ðŸ§¾ Evidence Diff Visualizer',
    subtitle: 'Persist hashed diffs between evidence bundles',
    accent: 'green',
    buttonClass: 'bg-green-600 hover:bg-green-700',
    buttonLabel: 'Record Diff',
    successMessage: 'âœ… Evidence diff captured',
    logLabel: 'Evidence Diff Snapshot',
    functionName: 'addComment',
    fields: [
      { key: 'baselineHash', label: 'Baseline Hash', placeholder: 'QmBaseline...' },
      { key: 'candidateHash', label: 'Candidate Hash', placeholder: 'QmCandidate...' },
      { key: 'diffSummary', label: 'Diff Summary', placeholder: 'Files changed, reviewers, anomalies', multiline: true },
    ],
  },
  {
    name: 'AchievementIntegrityBackfillEngine',
    flag: 'achievementIntegrityBackfillEngine',
    title: 'â™»ï¸ Integrity Backfill Engine',
    subtitle: 'Backfill historical proofs while preserving lineage',
    accent: 'blue',
    buttonClass: 'bg-blue-600 hover:bg-blue-700',
    buttonLabel: 'Log Backfill Run',
    successMessage: 'âœ… Backfill run notarized',
    logLabel: 'Integrity Backfill Log',
    functionName: 'createPost',
    fields: [
      { key: 'backfillEra', label: 'Backfill Era', placeholder: '2022-Q4' },
      { key: 'sourceSystem', label: 'Source System', placeholder: 'Linear, Notion, etc.' },
      { key: 'evidenceRoot', label: 'Evidence Root Hash', placeholder: '0xroot...' },
    ],
  },
  {
    name: 'AchievementCrossDomainIntentRouter',
    flag: 'achievementCrossDomainIntentRouter',
    title: 'ðŸŒ Cross-Domain Intent Router',
    subtitle: 'Route intents across chains with explicit settlement proofs',
    accent: 'orange',
    buttonClass: 'bg-orange-600 hover:bg-orange-700',
    buttonLabel: 'Route Intent',
    successMessage: 'âœ… Intent routing logged',
    logLabel: 'Intent Routing Record',
    functionName: 'createPost',
    fields: [
      { key: 'originDomain', label: 'Origin Domain', placeholder: 'Base L2' },
      { key: 'destinationDomain', label: 'Destination Domain', placeholder: 'Optimism, Arbitrum, etc.' },
      { key: 'intentSummary', label: 'Intent Summary', placeholder: 'Mint on Base, settle payout on Optimism', multiline: true },
    ],
  },
  {
    name: 'AchievementRecoveryGuardianCouncil',
    flag: 'achievementRecoveryGuardianCouncil',
    title: 'ðŸ›¡ï¸ Recovery Guardian Council',
    subtitle: 'Assign rotating guardian sets that can pause or thaw achievements',
    accent: 'green',
    buttonClass: 'bg-green-600 hover:bg-green-700',
    buttonLabel: 'Register Guardian Action',
    successMessage: 'âœ… Guardian council update stored',
    logLabel: 'Guardian Council Update',
    functionName: 'addComment',
    fields: [
      { key: 'councilLabel', label: 'Council Label', placeholder: 'Critical Relief Council' },
      { key: 'guardianAddress', label: 'Guardian Address', placeholder: '0xguard...' },
      { key: 'actionWindow', label: 'Action Window', placeholder: '72h pause authority' },
    ],
  },
  {
    name: 'AchievementDeterministicBatchReactor',
    flag: 'achievementDeterministicBatchReactor',
    title: 'ðŸ§ª Deterministic Batch Reactor',
    subtitle: 'Compose deterministic batch jobs with notarized traces',
    accent: 'purple',
    buttonClass: 'bg-purple-600 hover:bg-purple-700',
    buttonLabel: 'Record Batch Run',
    successMessage: 'âœ… Batch reactor trace stored',
    logLabel: 'Batch Reactor Run',
    functionName: 'createPost',
    fields: [
      { key: 'batchRunLabel', label: 'Batch Run Label', placeholder: 'weekly-auto-review' },
      { key: 'jobCount', label: 'Job Count (Optional)', placeholder: '12', required: false },
      { key: 'traceHash', label: 'Execution Trace Hash', placeholder: '0xtrace...' },
    ],
  },
  {
    name: 'AchievementZkKpiOracle',
    flag: 'achievementZkKpiOracle',
    title: 'ðŸ§® ZK KPI Oracle',
    subtitle: 'Publish KPI aggregates via zero-knowledge attestations',
    accent: 'blue',
    buttonClass: 'bg-blue-600 hover:bg-blue-700',
    buttonLabel: 'Post KPI Proof',
    successMessage: 'âœ… ZK KPI proof published',
    logLabel: 'ZK KPI Proof',
    functionName: 'createPost',
    fields: [
      { key: 'kpiChannel', label: 'KPI Channel', placeholder: 'Activation Score' },
      { key: 'proofCid', label: 'Proof CID', placeholder: 'ipfs://...' },
      { key: 'confidenceBand', label: 'Confidence Band', placeholder: 'p95 Â± 2.3%' },
    ],
  },
  {
    name: 'AchievementLiquidBacklogUnderwriter',
    flag: 'achievementLiquidBacklogUnderwriter',
    title: 'ðŸ’§ Liquid Backlog Underwriter',
    subtitle: 'Underwrite backlog items with bonded liquidity and slashing',
    accent: 'green',
    buttonClass: 'bg-emerald-600 hover:bg-emerald-700',
    buttonLabel: 'Underwrite Backlog Item',
    successMessage: 'âœ… Backlog item underwritten',
    logLabel: 'Backlog Underwriter Entry',
    functionName: 'createPost',
    fields: [
      { key: 'backlogItem', label: 'Backlog Item', placeholder: 'Retro funding dashboard' },
      { key: 'bondedLiquidity', label: 'Bonded Liquidity', placeholder: '2,500 USDC' },
      { key: 'expiryEpoch', label: 'Expiry / Review Epoch', placeholder: 'Epoch 45' },
    ],
  },
  {
    name: 'AchievementRewardCliffSimulator',
    flag: 'achievementRewardCliffSimulator',
    title: 'ðŸ“ˆ Reward Cliff Simulator',
    subtitle: 'Simulate vesting cliffs and payout curves',
    accent: 'orange',
    buttonClass: 'bg-orange-600 hover:bg-orange-700',
    buttonLabel: 'Log Simulation',
    successMessage: 'âœ… Cliff simulation captured',
    logLabel: 'Reward Cliff Simulation',
    functionName: 'createPost',
    fields: [
      { key: 'grantLabel', label: 'Grant Label', placeholder: 'Builder Incentive 2025' },
      { key: 'cliffDate', label: 'Cliff Date', placeholder: '2025-06-30' },
      { key: 'simulationHash', label: 'Simulation Hash', placeholder: '0xsim...' },
    ],
  },
  {
    name: 'AchievementGovernanceHeartbeatMonitor',
    flag: 'achievementGovernanceHeartbeatMonitor',
    title: 'â¤ï¸ Governance Heartbeat Monitor',
    subtitle: 'Emit signed heartbeats proving governance cadence',
    accent: 'purple',
    buttonClass: 'bg-purple-600 hover:bg-purple-700',
    buttonLabel: 'Record Heartbeat',
    successMessage: 'âœ… Governance heartbeat logged',
    logLabel: 'Governance Heartbeat',
    functionName: 'createPost',
    fields: [
      { key: 'governanceBody', label: 'Governance Body', placeholder: 'Builder DAO' },
      { key: 'heartbeatInterval', label: 'Heartbeat Interval', placeholder: 'Every 14 days' },
      { key: 'lastValidated', label: 'Last Validated', placeholder: '2025-01-20T11:00Z' },
    ],
  },
  {
    name: 'AchievementStreakAnchorVaults',
    flag: 'achievementStreakAnchorVaults',
    title: 'ðŸ“¦ Streak Anchor Vaults',
    subtitle: 'Lock streak proofs with weighted anchors',
    accent: 'blue',
    buttonClass: 'bg-blue-600 hover:bg-blue-700',
    buttonLabel: 'Anchor Streak',
    successMessage: 'âœ… Streak anchor recorded',
    logLabel: 'Streak Anchor Vault',
    functionName: 'addComment',
    fields: [
      { key: 'streakName', label: 'Streak Name', placeholder: 'shipping-run' },
      { key: 'anchorWeight', label: 'Anchor Weight', placeholder: '1.25x' },
      { key: 'decayRate', label: 'Decay Rate (Optional)', placeholder: '0.1 per missed check-in', required: false },
    ],
  },
  {
    name: 'AchievementCensorshipEscapeHatch',
    flag: 'achievementCensorshipEscapeHatch',
    title: 'ðŸšª Censorship Escape Hatch',
    subtitle: 'Describe mirror routes when RPCs censor proofs',
    accent: 'orange',
    buttonClass: 'bg-orange-600 hover:bg-orange-700',
    buttonLabel: 'Record Escape Route',
    successMessage: 'âœ… Escape hatch documented',
    logLabel: 'Censorship Escape Hatch',
    functionName: 'createPost',
    fields: [
      { key: 'mirrorChain', label: 'Mirror Chain', placeholder: 'Celestia DA' },
      { key: 'exitRoute', label: 'Exit Route', placeholder: 'Relayer > L2 > Base' },
      { key: 'relayStatus', label: 'Relay Status', placeholder: 'Ready, tested 3h ago', multiline: true },
    ],
  },
  {
    name: 'AchievementImpactWeightNotary',
    flag: 'achievementImpactWeightNotary',
    title: 'âš–ï¸ Impact Weight Notary',
    subtitle: 'Keep notarized weight calculations for impact scoring',
    accent: 'green',
    buttonClass: 'bg-green-600 hover:bg-green-700',
    buttonLabel: 'Notarize Weight',
    successMessage: 'âœ… Impact weight notarized',
    logLabel: 'Impact Weight Notary',
    functionName: 'addComment',
    fields: [
      { key: 'impactArea', label: 'Impact Area', placeholder: 'Public Goods' },
      { key: 'computedWeight', label: 'Computed Weight', placeholder: '0.82' },
      { key: 'reviewerHandle', label: 'Reviewer Handle', placeholder: '@validator.labs' },
    ],
  },
  {
    name: 'AchievementDelegatedWitnessSwarms',
    flag: 'achievementDelegatedWitnessSwarms',
    title: 'ðŸ Delegated Witness Swarms',
    subtitle: 'Register distributed witnesses for sensitive proofs',
    accent: 'purple',
    buttonClass: 'bg-purple-600 hover:bg-purple-700',
    buttonLabel: 'Register Witness',
    successMessage: 'âœ… Witness swarm updated',
    logLabel: 'Delegated Witness Swarm',
    functionName: 'addComment',
    fields: [
      { key: 'swarmName', label: 'Swarm Name', placeholder: 'latency-watchers' },
      { key: 'delegateAddress', label: 'Delegate Address', placeholder: '0xdelegate...' },
      { key: 'dutyWindow', label: 'Duty Window', placeholder: 'Week 08 Â· high sensitivity' },
    ],
  },
  {
    name: 'AchievementTreasuryDriftSentinel',
    flag: 'achievementTreasuryDriftSentinel',
    title: 'ðŸ’¹ Treasury Drift Sentinel',
    subtitle: 'Compare planned vs. actual outflows and flag drift',
    accent: 'blue',
    buttonClass: 'bg-blue-600 hover:bg-blue-700',
    buttonLabel: 'Log Drift Check',
    successMessage: 'âœ… Drift check persisted',
    logLabel: 'Treasury Drift Report',
    functionName: 'createPost',
    fields: [
      { key: 'budgetLine', label: 'Budget Line', placeholder: 'Ops â€” Infra' },
      { key: 'plannedSpend', label: 'Planned Spend', placeholder: '15,000 USDC' },
      { key: 'actualSpend', label: 'Actual Spend', placeholder: '18,400 USDC' },
    ],
  },
  {
    name: 'AchievementProgrammaticBonusStreams',
    flag: 'achievementProgrammaticBonusStreams',
    title: 'ðŸŽ Programmatic Bonus Streams',
    subtitle: 'Define programmable bonus streams that settle on KPI windows',
    accent: 'green',
    buttonClass: 'bg-emerald-600 hover:bg-emerald-700',
    buttonLabel: 'Configure Bonus Stream',
    successMessage: 'âœ… Bonus stream logged',
    logLabel: 'Bonus Stream Config',
    functionName: 'createPost',
    fields: [
      { key: 'streamLabel', label: 'Stream Label', placeholder: 'Retro cadence' },
      { key: 'kpiWindow', label: 'KPI Window', placeholder: 'Week 10 - Week 12' },
      { key: 'bonusAmount', label: 'Bonus Amount', placeholder: '950 USDC' },
    ],
  },
  {
    name: 'AchievementEthicsDisclosureLedger',
    flag: 'achievementEthicsDisclosureLedger',
    title: 'ðŸ“ Ethics Disclosure Ledger',
    subtitle: 'Store disclosures for data usage or AI claims',
    accent: 'orange',
    buttonClass: 'bg-orange-600 hover:bg-orange-700',
    buttonLabel: 'Log Disclosure',
    successMessage: 'âœ… Disclosure anchored',
    logLabel: 'Ethics Disclosure',
    functionName: 'createPost',
    fields: [
      { key: 'disclosureTopic', label: 'Disclosure Topic', placeholder: 'Training data provenance' },
      { key: 'evidenceLink', label: 'Evidence Link', placeholder: 'https://...' },
      { key: 'signatureHash', label: 'Signature Hash', placeholder: '0xsig...' },
    ],
  },
  {
    name: 'AchievementAutoprunedEvidenceTrees',
    flag: 'achievementAutoprunedEvidenceTrees',
    title: 'ðŸŒ¿ Autopruned Evidence Trees',
    subtitle: 'Auto-prune redundant evidence with proof-of-deletion logs',
    accent: 'green',
    buttonClass: 'bg-green-600 hover:bg-green-700',
    buttonLabel: 'Record Prune Event',
    successMessage: 'âœ… Evidence prune recorded',
    logLabel: 'Autopruned Evidence Entry',
    functionName: 'addComment',
    fields: [
      { key: 'treeIdentifier', label: 'Tree Identifier', placeholder: 'evidence-root-v3' },
      { key: 'nodesPruned', label: 'Nodes Pruned (Optional)', placeholder: '17', required: false },
      { key: 'proofHash', label: 'Proof Hash', placeholder: '0xproof...' },
    ],
  },
  {
    name: 'AchievementFailureModeSandbox',
    flag: 'achievementFailureModeSandbox',
    title: 'ðŸ”¥ Failure Mode Sandbox',
    subtitle: 'Sandbox catastrophic scenarios and recovery plans',
    accent: 'purple',
    buttonClass: 'bg-purple-600 hover:bg-purple-700',
    buttonLabel: 'Log Scenario',
    successMessage: 'âœ… Failure mode sandbox logged',
    logLabel: 'Failure Mode Scenario',
    functionName: 'createPost',
    fields: [
      { key: 'scenarioName', label: 'Scenario Name', placeholder: 'RPC outage w/ 50% packet loss' },
      { key: 'blastRadius', label: 'Blast Radius', placeholder: 'Affects deploy + wallet overlay' },
      { key: 'recoveryTime', label: 'Recovery Time', placeholder: '37 minutes' },
    ],
  },
  {
    name: 'AchievementSlaEscrowMonitor',
    flag: 'achievementSlaEscrowMonitor',
    title: 'ðŸ“‰ SLA Escrow Monitor',
    subtitle: 'Escrow service-level guarantees and slash on breaches',
    accent: 'blue',
    buttonClass: 'bg-blue-600 hover:bg-blue-700',
    buttonLabel: 'Record SLA Check',
    successMessage: 'âœ… SLA check notarized',
    logLabel: 'SLA Escrow Check',
    functionName: 'addComment',
    fields: [
      { key: 'serviceName', label: 'Service Name', placeholder: 'Realtime Notifier' },
      { key: 'slaThreshold', label: 'SLA Threshold', placeholder: '99.5% uptime' },
      { key: 'breachResponse', label: 'Breach Response', placeholder: 'Slash escrow + notify guardians', multiline: true },
    ],
  },
  {
    name: 'AchievementReentryTimelockGuard',
    flag: 'achievementReentryTimelockGuard',
    title: 'â³ Re-entry Timelock Guard',
    subtitle: 'Enforce cooldowns for renegotiated milestones or disputes',
    accent: 'orange',
    buttonClass: 'bg-orange-600 hover:bg-orange-700',
    buttonLabel: 'Enforce Timelock',
    successMessage: 'âœ… Timelock guard stored',
    logLabel: 'Re-entry Timelock Guard',
    functionName: 'addComment',
    fields: [
      { key: 'timelockLabel', label: 'Timelock Label', placeholder: 'Post-dispute lock' },
      { key: 'cooldownSeconds', label: 'Cooldown (seconds)', placeholder: '86400' },
      { key: 'unlockPolicy', label: 'Unlock Policy', placeholder: 'Requires guardian quorum', multiline: true },
    ],
  },
  {
    name: 'AchievementOmnichainInboxRouter',
    flag: 'achievementOmnichainInboxRouter',
    title: 'ðŸ“¬ Omnichain Inbox Router',
    subtitle: 'Normalize inbound proofs from any chain with replay protection',
    accent: 'blue',
    buttonClass: 'bg-blue-600 hover:bg-blue-700',
    buttonLabel: 'Register Inbox Packet',
    successMessage: 'âœ… Inbox packet traced',
    logLabel: 'Omnichain Inbox Packet',
    functionName: 'createPost',
    fields: [
      { key: 'sourceChain', label: 'Source Chain', placeholder: 'Linea' },
      { key: 'payloadId', label: 'Payload ID', placeholder: 'payload-123' },
      { key: 'replayVector', label: 'Replay Protection Vector', placeholder: 'nonce:87123 Â· salt:7', multiline: true },
    ],
  },
  {
    name: 'AchievementAdaptiveReputationBonds',
    flag: 'achievementAdaptiveReputationBonds',
    title: 'ðŸª™ Adaptive Reputation Bonds',
    subtitle: 'Create adaptive bonding curves where reputation backing adjusts in real time',
    accent: 'green',
    buttonClass: 'bg-green-600 hover:bg-green-700',
    buttonLabel: 'Update Reputation Bond',
    successMessage: 'âœ… Reputation bond updated',
    logLabel: 'Adaptive Reputation Bond',
    functionName: 'addComment',
    fields: [
      { key: 'bondLabel', label: 'Bond Label', placeholder: 'Reviewer Pool A' },
      { key: 'currentWeight', label: 'Current Weight', placeholder: '0.65' },
      { key: 'targetWeight', label: 'Target Weight', placeholder: '0.80' },
    ],
  },
]

const capitalize = (value) => value.charAt(0).toUpperCase() + value.slice(1)

const buildFieldBlock = (field) => {
  const stateName = field.key
  const setter = `set${capitalize(stateName)}`
  const control = field.multiline
    ? [
        '        <div>',
        `          <label className="block text-sm font-medium text-gray-700 mb-2">${field.label}</label>`,
        '          <textarea',
        `            value={${stateName}}`,
        `            onChange={(e) => ${setter}(e.target.value)}`,
        `            placeholder="${field.placeholder}"`,
        `            rows={${field.rows ?? 3}}`,
        '            className="w-full rounded-lg border border-gray-300 p-2 text-sm"',
        '          />',
        '        </div>',
      ]
    : [
        '        <div>',
        `          <label className="block text-sm font-medium text-gray-700 mb-2">${field.label}</label>`,
        '          <input',
        '            type="text"',
        `            value={${stateName}}`,
        `            onChange={(e) => ${setter}(e.target.value)}`,
        `            placeholder="${field.placeholder}"`,
        '            className="w-full rounded-lg border border-gray-300 p-2 text-sm"',
        '          />',
        '        </div>',
      ]
  return control.join('\n')
}

const buildComponent = (feature) => {
  const stateLines = feature.fields
    .map((field) => `  const [${field.key}, set${capitalize(field.key)}] = useState('')`)
    .join('\n')

  const requiredChecks = feature.fields
    .filter((field) => field.required !== false)
    .map((field) => `!${field.key}.trim()`)

  const missingExpr = requiredChecks.length ? ` || ${requiredChecks.join(' || ')}` : ''

  const fieldBlocks = feature.fields.map(buildFieldBlock).join('\n\n')

  const contentLines = [feature.logLabel, 'Achievement: #${achievementId.toString()}']
  feature.fields.forEach((field) => {
    const optional = field.required === false
    const suffix = optional ? ` || 'N/A'` : ''
    contentLines.push(`${field.label}: \${${field.key}${suffix}}`)
  })
  const contentString = contentLines.join('\\n')

  const args = feature.functionName === 'createPost' ? '[content]' : '[achievementId, content]'

  return [
    "'use client'",
    '',
    "import { useAccount, useWriteContract, useWaitForTransactionReceipt } from 'wagmi'",
    "import { BUILDER_PROOF_CONTRACT } from '@/lib/constants'",
    "import { BuilderProofABI } from '@/abi/BuilderProof'",
    "import AppCard from '@/components/common/AppCard'",
    "import { useState } from 'react'",
    "import { isFeatureEnabled } from '@/lib/featureFlags'",
    '',
    `interface ${feature.name}Props {`,
    '  achievementId: bigint',
    '}',
    '',
    `export default function ${feature.name}({ achievementId }: ${feature.name}Props) {`,
    '  const { address, isConnected } = useAccount()',
    stateLines || '',
    '  const { writeContract, data: hash, isPending } = useWriteContract()',
    '  const { isLoading: isConfirming, isSuccess: isConfirmed } = useWaitForTransactionReceipt({ hash })',
    '',
    `  if (!isFeatureEnabled('${feature.flag}')) {`,
    '    return null',
    '  }',
    '',
    `  const handle${feature.name} = async () => {`,
    `    if (!isConnected || !address${missingExpr}) return`,
    '',
    '    try {',
    `      const content = \`${contentString}\``,
    '      writeContract({',
    "        address: BUILDER_PROOF_CONTRACT as `0x${string}`,",
    '        abi: BuilderProofABI,',
    `        functionName: '${feature.functionName}',`,
    `        args: ${args},`,
    '      })',
    '    } catch (error) {',
    `      console.error('${feature.logLabel} submission failed:', error)`,
    '    }',
    '  }',
    '',
    '  return (',
    `    <AppCard title="${feature.title}" subtitle="${feature.subtitle}" accent="${feature.accent}">`,
    '      <div className="space-y-4">',
    fieldBlocks,
    '        <button',
    `          onClick={handle${feature.name}}`,
    `          disabled={isPending || isConfirming || !isConnected || !address${missingExpr ? ` || ${requiredChecks.join(' || ')}` : ''}}`,
    `          className="w-full rounded-lg ${feature.buttonClass} px-4 py-2 text-sm font-semibold text-white disabled:bg-gray-400"`,
    '        >',
    `          {isPending || isConfirming ? 'Recording...' : '${feature.buttonLabel}'}`,
    '        </button>',
    '        {isConfirmed && (',
    "          <div className=\"rounded-lg bg-green-50 border border-green-200 p-3 text-sm text-green-800\">",
    `            ${feature.successMessage}`,
    '          </div>',
    '        )}',
    '      </div>',
    '    </AppCard>',
    '  )',
    '}',
    '',
  ].join('\n')
}

const target = process.env.FEATURE
if (!target) {
  console.error('FEATURE env var is required')
  process.exit(1)
}

const feature = features.find((item) => item.name === target)
if (!feature) {
  console.error(`Unknown feature: ${target}`)
  process.exit(1)
}

const targetPath = join(process.cwd(), 'components', 'onchain', `${feature.name}.tsx`)
if (existsSync(targetPath)) {
  console.log(`Skipping ${feature.name}, file already exists`)
  process.exit(0)
}

const content = buildComponent(feature)
writeFileSync(targetPath, content)
console.log(`Generated ${feature.name}`)
